<!DOCTYPE html>
<html>
  <head>
    <title>Deno talk Nov 2021</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    
    <style type="text/css">
      body {
  font-family: 'Avenir Next', 'Hiragino Kaku Gothic ProN', 'Meiryo', 'ãƒ¡ã‚¤ãƒªã‚ª', sans-serif;
  font-weight: bold;
}
h1, h2, h3 {
  font-weight: bold;
}
.remark-code,
.remark-inline-code {
  font-family: 'Menlo', 'Monaco', 'Courier new', monospace;
  background-color: #eeeeee;
  padding: 4px 16px;
  border-radius: 8px;
}

code.remark-code {
  display: block;
  padding: 0.7em;
  border-radius: 5px;
  background-color: #272822;
  color: #f3f3f3;
  font-size: 23px;
}

.remark-slide-content {
  color: #24292e;
  font-size: 32px;
  padding: 15px 60px;
}

.remark-slide-content.inverse {
  color: #f3f3f3;
  background-color: #272822;
}

.remark-slide-number a {
  color: #24292e;
  text-decoration: none;
}

.inverse .remark-slide-number a {
  color: #f3f3f3;
}

.inverse a:visited, .inverse a {
  color: #3393f3;
  text-decoration: none;
}

.remark-slide-content a:visited, .remark-slice-content a {
  color: #3393f3;
  text-decoration: none;
}

    </style>
  </head>
  <body>
    <textarea id="source">class: middle, center

<img src="./assets/logo.svg" align="center" width="200" />

# Deno ã®è©±

---
class: center middle

Deno ä½¿ã£ã¦ã¾ã™ã‹? ğŸ™‹â€â™€ï¸ğŸ™‹â€â™‚ï¸

---

# è©±ã™äºº

<img src="./assets/hinosawa.jpg" align="right" width="300" />

æ—¥é‡æ¾¤æ­“ä¹Ÿ twitter @kt3k

- GREE (2012 - 2013)
- Recruit (2015 - 2019)
- Deno Land (2021 -)

<small>2018å¹´ã‹ã‚‰ Deno ã«ã‚³ãƒ³ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ãƒˆã‚’é–‹å§‹ã€‚2020å¹´ä½œè€…ã«èª˜ã‚ã‚Œ Deno Land ã«è»¢è·ã€‚ç¾åœ¨ã¯ãƒ•ãƒ«ã‚¿ã‚¤ãƒ ã§ Deno ã¨ Deno Deploy ã‚’é–‹ç™ºä¸­ã€‚</small>

---
class: inverse middle center

Deno ã®ãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—

---
Deno ã®ã“ã‚Œã¾ã§ã®ãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—
- Web äº’æ›æ€§
- TypeScript ã‚µãƒãƒ¼ãƒˆ
- ESM ã‚µãƒãƒ¼ãƒˆ
- V8 ã‚µãƒ³ãƒ‰ãƒœãƒƒã‚¯ã‚¹ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£
- Node ã‚’ä¸Šå›ã‚‹HTTPãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹

---
Deno ã®ã“ã‚Œã¾ã§ã®ãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—
- Web äº’æ›æ€§ â–²
- TypeScript ã‚µãƒãƒ¼ãƒˆ âœ…
- ESM ã‚µãƒãƒ¼ãƒˆ âœ…
- V8 ã‚µãƒ³ãƒ‰ãƒœãƒƒã‚¯ã‚¹ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ âœ…
- Node ã‚’ä¸Šå›ã‚‹HTTPãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ âŒ

v1.0 æ™‚ç‚¹

---
Deno ã®ã“ã‚Œã¾ã§ã®ãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—
- Web äº’æ›æ€§ âœ…
- TypeScript ã‚µãƒãƒ¼ãƒˆ âœ…
- ESM ã‚µãƒãƒ¼ãƒˆ âœ…
- V8 ã‚µãƒ³ãƒ‰ãƒœãƒƒã‚¯ã‚¹ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ âœ…
- Node ã‚’ä¸Šå›ã‚‹HTTPãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ â–²

v1.16 (æœ€æ–°) ã§ã¯å¤§éƒ¨åˆ†é”æˆ

---
Deno ã®ã“ã‚Œã‹ã‚‰ã®ãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—

---
Deno ã®ã“ã‚Œã‹ã‚‰ã®ãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—

- ã•ã‚‰ãªã‚‹HTTPãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å‘ä¸Š
- Node.js äº’æ›æ€§ (å¾Œè¿°)

---
class: inverse middle center

Q. Nodeè£½ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¯Denoã§ä½¿ãˆã‚‹ã‹

---
Q. Nodeè£½ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¯Denoã§ä½¿ãˆã‚‹ã‹

A. ä¸»ã«2ã¤ã®æ–¹æ³•ãŒã‚ã‚‹ (ã©ã¡ã‚‰ã‚‚å®Œç’§ã§ã¯ãªã„)

- npm ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ Deno ç”¨ã«å¤‰æ›ã™ã‚‹ CDN ã‚’ä»‹ã—ã¦ä½¿ã†æ–¹æ³• (éå…¬å¼)
- Deno ã® Node.js äº’æ›ãƒ¢ãƒ¼ãƒ‰ã‚’ä½¿ã†(2022 Q2 äºˆå®š)æ–¹æ³• (å…¬å¼)

---

1) npm ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ Deno ç”¨ã«å¤‰æ›ã™ã‚‹ CDN ã‚’ä»‹ã—ã¦ä½¿ã† (éå…¬å¼)

- esm.sh <br />`https://esm.sh/<packageå>`
- skypack <br />`https://cdn.skypack.dev/<packageå>`

React ãªã©ã¯ã“ã®æ‰‹æ³•ã§å‹•ã

```
import React from "https://esm.sh/react";
import ReactDOM from "https://esm.sh/react-dom";
```

---
2) Deno ã® Node.js äº’æ›ãƒ¢ãƒ¼ãƒ‰ã‚’ä½¿ã†

- ç¾åœ¨ã€Deno ã‚³ã‚¢ãƒãƒ¼ãƒ ã«ã¦é‹­æ„é–‹ç™ºä¸­
- 2022 Q2 ã® v2 ãƒªãƒªãƒ¼ã‚¹ã§ã‚ã‚‹ç¨‹åº¦ä½¿ãˆã‚‹çŠ¶æ…‹ã«ã™ã‚‹äº‹ãŒç›®æ¨™

```
npm install express
deno run --compat --unstable -A server.js
```

```js
const express = require('express')
const app = express()
app.get('/', (req, res) => {
  res.send('Hello World!')
})
console.log('Listening on localhost:3000');
app.listen(3000)
```

---
Node.js äº’æ›ãƒ¢ãƒ¼ãƒ‰ã«ã¤ã„ã¦ã¯ [v1.5 ãƒªãƒªãƒ¼ã‚¹è¨˜äº‹](https://deno.com/blog/v1.15#improving-node-compatibility) ã«æ¦‚è¦ã®è¨˜è¿°ãŒã‚ã‚Šã¾ã™ã€‚


---
class: inverse middle center

Q. æ¨©é™ç®¡ç†ã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã¯?

---
Q. æ¨©é™ç®¡ç†ã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã¯?

A. å¿…è¦æœ€å°é™ã®ã‚‚ã®ã‚’æ¸¡ã™

ä¾‹. ãƒªãƒ³ã‚¿ãƒ¼
```
deno run --allow-read linter.ts
```

ä¾‹. ãƒ•ã‚©ãƒ¼ãƒãƒƒã‚¿ãƒ¼
```
deno run --allow-read --allow-write formatter.ts
```

---
Q. æ¨©é™ç®¡ç†ã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã¯?

A. ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒ‘ãƒ¼ãƒŸãƒƒã‚·ãƒ§ãƒ³ã‚’æ¸¡ã™å ´åˆã¯ãƒ›ã‚¹ãƒˆåã‚’æŒ‡å®šã™ã‚‹

ä¾‹. ãƒãƒ¼ãƒˆ8080ã§å‹•ãã€Postgres ã¨é€šä¿¡ã™ã‚‹ã‚µãƒ¼ãƒãƒ¼
```
deno run \
  --allow-net=localhost:8080,host-to.postgres:5432 \
  server.ts
```

---
Q. æ¨©é™ç®¡ç†ã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã¯?

A. ç’°å¢ƒå¤‰æ•°ã€ãƒ—ãƒ­ã‚»ã‚¹å®Ÿè¡Œã¯è¨±å¯ç¯„å›²ã‚’å‡ºæ¥ã‚‹ã ã‘çµã‚‹

```
deno run \
  --allow-env=AWS_ACCESS_KEY_ID,AWS_SECRET_ACCESS_KEY \
  do_something_in_aws.ts
```

```
deno run --allow-run=git do_something_with_git.ts
```

---
Q. æ¨©é™ç®¡ç†ã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã¯?

Note: `--allow-run` (å¼•æ•°ãªã—) `--allow-run=deno` ã¯ `--allow-all` (ã™ã¹ã¦è¨±å¯) ã¨åŒã˜ã¨ãªã‚‹ãŸã‚æ³¨æ„

ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã§æ¨©é™ã®æ˜‡æ ¼ãŒå¯èƒ½
```
Deno.run({
  cmd: ["deno", "run", "--allow-all", import.meta.url]
});
```

---
class: inverse middle center
Webã‚µãƒ¼ãƒç”¨ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªæ¯”è¼ƒ

---
Webã‚µãƒ¼ãƒç”¨ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªæ¯”è¼ƒ

- Webãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ãŒ20å€‹ãã‚‰ã„ã‚ã‚‹ã€‚
- ä»¥ä¸‹ãŠã™ã™ã‚ã‚’ç´¹ä»‹

---
1) oak

- ä¸€ç•ªäººæ°—
- koa ã«ã‚¤ãƒ³ã‚¹ãƒ‘ã‚¤ã‚¢ã•ã‚ŒãŸãƒ‡ã‚¶ã‚¤ãƒ³

```ts
import { Application, Router }
  from "https://deno.land/x/oak/mod.ts";

const router = new Router()
  .get("/", (context) => {
    context.response.body = "Hello world!";
  })
  .get("/book/:id", (context) => {
    context.response.body = books.get(context.params.id);
  });

const app = new Application();
app.use(router.routes());
await app.listen({ port: 8000 });
```

---
2) `std/http` + [URLPattern](https://developer.mozilla.org/en-US/docs/Web/API/URLPattern) API

- std/http ã¯ Deno æ¨™æº–ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãŒæä¾›ã™ã‚‹ http ã‚µãƒ¼ãƒãƒ¼æ©Ÿèƒ½

```ts
import { serve }
  from "https://deno.land/std@0.114.0/http/server.ts";

const topPage = new URLPattern({ pathname: "/" });
const myPage = new URLPattern({ pathname: "/me" });

console.log("Listening on http://localhost:8000");
await serve((req) => {
  if (topPage.test(req.url))
    return new Response("Top page");
  if (myPage.test(req.url))
    return new Response("My page");
  return new Response("Not Found", { status: 404 });
});
```

---
3) sift

- JSX å¯¾å¿œãªã©ãŒä¾¿åˆ©ã€ãƒŸãƒ‹ãƒãƒ«ãª API

```js
/** @jsx h */
import { h, jsx, serve }
  from "https://deno.land/x/sift@0.4.2/mod.ts";

const App =
  () => <div><h1>Hello world!</h1></div>;

const NotFound =
  () => <div><h1>Page not found</h1></div>;

serve({
  "/": () => jsx(<App />),
  404: () => jsx(<NotFound />, { status: 404 }),
});
```

---
class: inverse middle center

Q. When will deno be production ready

---
Q. When will deno be production ready

- It depends on what you need in production.
- ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã®å®‰å®šæ€§ã¨ã„ã†æ„å‘³ã§ã¯æ—¢ã« production ready ã¨è¨€ã£ã¦è‰¯ã„æ®µéš
- API ã‚‚ 1.0 ä»¥é™ã¯ semver ã‚’éµå®ˆã—ã¦ã„ã‚‹ãŸã‚ã€ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚¢ãƒƒãƒ—ã§æ€¥ã«å£Šã‚ŒãŸã‚Šã¯ã—ãªã„
- npm ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãŒä½¿ãˆãªã‘ã‚Œã°å›°ã‚‹ã¨ã„ã†äº‹ã§ã‚ã‚Œã° 2022 Q2 (ç›®æ¨™) ã® Node.js äº’æ›ãƒ¢ãƒ¼ãƒ‰ã‚’ä¸€æ—¦å¾…ã£ã¦ãã ã•ã„

---
class: inverse middle center

Q. deno ãŒ TS ã‚’æ¨ã¦ãŸã¨ãã®è£è©±? ãŒã‚ã‚Œã°èããŸã„

https://docs.google.com/document/d/1_WvwHl7BXUPmoiSeD8G83JmS8ypsTPqed4Btkqkn_-4/preview?pru=AAABcrrKL5k*nQ4LS569NsRRAce2BVanXw

---
deno ãŒ TS ã‚’æ¨ã¦ãŸè©±

- å†…éƒ¨ API å®Ÿè£…ã§ Deno ã¯æœ€åˆã¯ TS ã‚’ä½¿ã£ã¦ã„ãŸãŒã€ãã‚Œã‚’è¾ã‚ã¦ç´ ã® JS ã‚’ä½¿ã†ã‚ˆã†ã«ãªã£ãŸã¨ã„ã†è©±

---
deno ãŒ TS ã‚’æ¨ã¦ãŸè©±

- å†…éƒ¨ API ã® TS ã¯ Deno ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒä½¿ã† TS ã¨ã¯å…¨ãåˆ¥ç‰©ã§ç‹¬è‡ªã®å°‚ç”¨ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã§ãƒãƒ³ãƒ‰ãƒ«ã—ã¦ã„ãŸ
  - ãã‚‚ãã‚‚ãƒ¡ãƒ³ãƒ†ã§ãã‚‹äººãŒé™ã‚‰ã‚Œã¦ã„ãŸ
- dts å®šç¾©ãªã©ã‚‚ç‹¬è‡ªãƒ„ãƒ¼ãƒ«ã§ç”Ÿæˆã—ã¦ã„ãŸãŒã€ãã®ãƒ„ãƒ¼ãƒ«ã®ãƒã‚°ã§ç‰¹å®šã®å‹ã® API ãŒå®šç¾©å‡ºæ¥ãªã„ä¸éƒ½åˆãªã©ãŒã‚ã£ãŸ
  - ãƒ¡ãƒ³ãƒ†ã§ãã‚‹äººã‚‚ã»ã¼1äººã ã£ãŸ

=> è¾›ã•ãŒé™ç•Œã«é”ã—ã€TS ã‚’ã‚„ã‚ãŸæ–¹ãŒè‰¯ã„ã¨ã„ã†åˆ¤æ–­ã«ãªã£ãŸ

---
class: inverse middle center

Q. ORMæ¯”è¼ƒ

---
ORM æ¯”è¼ƒ

- ç¾çŠ¶ã ã¨ denodb ã—ã‹é¸æŠè‚¢ãŒãªã•ãã†ã€‚<br />å‚è€ƒ: [Deno ã§è©¦ã™ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¢ã‚¯ã‚»ã‚¹](https://ccbaxy.xyz/blog/2021/07/01/js23/)

- [prisma ã¯æœªå¯¾å¿œ](https://github.com/prisma/prisma/issues/2452)

- ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã¯ [Nessie](https://github.com/halvardssm/deno-nessie) ãŒãã‚Œãªã‚Šã«å‹•ã„ã¦ã‚‹æ¨¡æ§˜

(Deno ã‚³ã‚¢ãƒãƒ¼ãƒ ã¯ ORM ã«å¯¾ã™ã‚‹æ„è­˜ãŒãŠãã‚‰ãã‹ãªã‚Šä½ã„)

---
class: middle center

<img src="./assets/logo.svg" align="center" width="200" />

End
</textarea>
    <script src="remark.js"></script>
    
    <script>
      window.slideshow = remark.create({"slideNumberFormat":"Deno ã®è©± 2021 @kt3k - %current% / %total%"})
    </script>
    
    <script>
      
      ;window.LiveReloadOptions = {
        host: 'localhost',
        port: '35729'
      };
    </script>
  </body>
</html>
